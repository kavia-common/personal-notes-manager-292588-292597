{"is_source_file": true, "format": "TypeScript", "description": "This file defines types, interfaces, and a class for managing notes stored in localStorage, providing a store with subscription capabilities for a notes application.", "external_files": ["localStorage", "import.meta.env"], "external_methods": ["localStorage.getItem", "localStorage.setItem", "JSON.parse", "JSON.stringify", "Date.now", "crypto.randomUUID"], "published": ["Note", "NotesState", "NotesListener", "pickAdapter", "notesStore"], "classes": [{"name": "NotesStore", "description": "Main class managing the notes state, persistence, and subscriptions for a note-taking app."}], "methods": [{"name": "export function humanDate(ms: number): string { humanDate", "description": "Converts a timestamp in milliseconds into a human-readable date string.", "scope": "", "scopeKind": ""}, {"name": "function pickAdapter(): StorageAdapter { pickAdapter", "description": "Chooses and returns a storage adapter based on environment variables; currently always returns LocalStorageAdapter.", "scope": "", "scopeKind": ""}, {"name": "subscribe", "description": "Allows components to subscribe to store updates; returns an unsubscribe function."}, {"name": "getState", "description": "Returns a shallow copy of the current notes state."}, {"name": "init", "description": "Loads notes from storage and initializes the store, setting the most recent note as selected."}, {"name": "create", "description": "Creates a new note with optional title and content, assigns it a unique id, sets it as selected, and persists."}, {"name": "update", "description": "Updates a note's title and/or content, updates the timestamp, reorders, and persists."}, {"name": "remove", "description": "Deletes a note by id, and if it was selected, updates the selection to the next most recent."}, {"name": "function isBrowser(): boolean { isBrowser", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async load(): Promise<Note[]> { load", "scope": "LocalStorageAdapter", "scopeKind": "class", "description": "unavailable"}, {"name": "load(): Promise<Note[]>; load", "scope": "StorageAdapter", "scopeKind": "interface", "description": "unavailable"}, {"name": "function loadCurrent() { loadCurrent", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function render() { render", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async save(notes: Note[]): Promise<void> { save", "scope": "LocalStorageAdapter", "scopeKind": "class", "description": "unavailable"}, {"name": "save(notes: Note[]): Promise<void>; save", "scope": "StorageAdapter", "scopeKind": "interface", "description": "unavailable"}], "search-terms": ["NotesStore", "localStorageAdapter", "persistence", "notes management", "TypeScript types", "notes store", "initialization"], "state": 2, "file_id": 8, "knowledge_revision": 17, "git_revision": "", "ctags": [{"_type": "tag", "name": "LocalStorageAdapter", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^class LocalStorageAdapter implements StorageAdapter {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "Note", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export type Note = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "NotesListener", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export type NotesListener = (state: NotesState) => void;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "NotesState", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export type NotesState = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "NotesStore", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^class NotesStore {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "STORAGE_KEY", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^const STORAGE_KEY = 'notes.v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "StorageAdapter", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export interface StorageAdapter {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "apiBase", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const apiBase = import.meta.env.PUBLIC_API_BASE || import.meta.env.PUBLIC_BACKEND_URL || '';$/", "language": "TypeScript", "kind": "constant", "scope": "pickAdapter", "scopeKind": "function"}, {"_type": "tag", "name": "cancelBtn", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const cancelBtn = editor.querySelector('[data-cancel]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const content = contentInput.value;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "contentInput", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const contentInput = editor.querySelector('[data-field=\"content\"]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "countEl", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const countEl = document.querySelector('[data-count]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "createBtn", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const createBtn = document.querySelector('[data-create]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "createBtn", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const createBtn = document.querySelector('[data-create]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "created", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      const created = await store.create(title, content);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "crypto", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      id: crypto.randomUUID ? crypto.randomUUID() : String(now) + Math.random().toString(16).sli/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "d", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const d = new Date(ms);$/", "language": "TypeScript", "kind": "constant", "scope": "humanDate", "scopeKind": "function"}, {"_type": "tag", "name": "date", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^        const date = document.createElement('p');$/", "language": "TypeScript", "kind": "constant", "scope": "render", "scopeKind": "function"}, {"_type": "tag", "name": "editor", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const editor = document.querySelector('[data-editor]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "emptyEl", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const emptyEl = document.querySelector('[data-empty]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "filter", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    let filter = '';$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "humanDate", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export function humanDate(ms: number): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const id = state.selectedId;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const idx = this.state.notes.findIndex((n) => n.id === id);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const updated: Note = { ...this.state.notes[idx], ...patch, updatedAt: now };$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "init", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^const init = `$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "isBrowser", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^function isBrowser(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "l", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    for (const l of Array.from(this.listeners)) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "li", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^        const li = document.createElement('li');$/", "language": "TypeScript", "kind": "constant", "scope": "render", "scopeKind": "function"}, {"_type": "tag", "name": "listEl", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const listEl = document.querySelector('[data-note-list]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "listeners", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  private listeners: Set<NotesListener> = new Set();$/", "language": "TypeScript", "kind": "property", "scope": "NotesStore", "scopeKind": "class"}, {"_type": "tag", "name": "load", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  async load(): Promise<Note[]> {$/", "language": "TypeScript", "kind": "method", "scope": "LocalStorageAdapter", "scopeKind": "class"}, {"_type": "tag", "name": "load", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  load(): Promise<Note[]>;$/", "language": "TypeScript", "kind": "method", "scope": "StorageAdapter", "scopeKind": "interface"}, {"_type": "tag", "name": "loadCurrent", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  function loadCurrent() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "n", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      for (const n of notes) {$/", "language": "TypeScript", "kind": "constant", "scope": "render", "scopeKind": "function"}, {"_type": "tag", "name": "note", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const note = state.notes.find(n => n.id === state.selectedId);$/", "language": "TypeScript", "kind": "constant", "scope": "loadCurrent", "scopeKind": "function"}, {"_type": "tag", "name": "note", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const note: Note = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "notes", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      const notes = state.notes.filter(n => n.title.toLowerCase().includes(filter));$/", "language": "TypeScript", "kind": "constant", "scope": "render", "scopeKind": "function"}, {"_type": "tag", "name": "notes", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const notes = await this.adapter.load();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "notesStore", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export const notesStore = new NotesStore(pickAdapter());$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const now = Date.now();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "parsed", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      const parsed = JSON.parse(raw);$/", "language": "TypeScript", "kind": "constant", "scope": "LocalStorageAdapter.load", "scopeKind": "method"}, {"_type": "tag", "name": "pickAdapter", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^function pickAdapter(): StorageAdapter {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      const raw = localStorage.getItem(STORAGE_KEY);$/", "language": "TypeScript", "kind": "constant", "scope": "LocalStorageAdapter.load", "scopeKind": "method"}, {"_type": "tag", "name": "render", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    function render() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "save", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  async save(notes: Note[]): Promise<void> {$/", "language": "TypeScript", "kind": "method", "scope": "LocalStorageAdapter", "scopeKind": "class"}, {"_type": "tag", "name": "save", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  save(notes: Note[]): Promise<void>;$/", "language": "TypeScript", "kind": "method", "scope": "StorageAdapter", "scopeKind": "interface"}, {"_type": "tag", "name": "saveBtn", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const saveBtn = editor.querySelector('[data-save]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "searchInput", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const searchInput = document.querySelector('[data-search]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "state", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const state = store.getState();$/", "language": "TypeScript", "kind": "constant", "scope": "loadCurrent", "scopeKind": "function"}, {"_type": "tag", "name": "state", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const state = store.getState();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "state", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    let state = store.getState();$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "state", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  private state: NotesState = { notes: [], selectedId: null };$/", "language": "TypeScript", "kind": "property", "scope": "NotesStore", "scopeKind": "class"}, {"_type": "tag", "name": "store", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const store = window.__notesStore;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "store", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const store = window.notesStore;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^        const title = document.createElement('p');$/", "language": "TypeScript", "kind": "constant", "scope": "render", "scopeKind": "function"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const title = titleInput.value.trim() || 'Untitled';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "titleInput", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const titleInput = editor.querySelector('[data-field=\"title\"]');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const updated: Note = { ...this.state.notes[idx], ...patch, updatedAt: now };$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "updatedAt", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const updated: Note = { ...this.state.notes[idx], ...patch, updatedAt: now };$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "wasSelected", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const wasSelected = this.state.selectedId === id;$/", "language": "TypeScript", "kind": "constant"}], "hash": "6b39017845c417cd782e4ba65b7fc29a", "format-version": 4, "code-base-name": "frontend", "filename": "frontend/src/lib/notesStore.ts", "fields": [{"name": "export interface StorageAdapter {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let filter = '';", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private listeners: Set<NotesListener> = new Set();", "scope": "NotesStore", "scopeKind": "class", "description": "unavailable"}, {"name": "let state = store.getState();", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private state: NotesState = { notes: [], selectedId: null };", "scope": "NotesStore", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"17": ""}]}