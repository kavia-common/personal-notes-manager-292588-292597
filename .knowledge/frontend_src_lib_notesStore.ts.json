{"is_source_file": true, "format": "TypeScript", "description": "This file defines types and classes for managing notes in a frontend application. It includes data type definitions, a storage adapter interface with a local storage implementation, and a store class for managing notes' state, subscription, persistence, and CRUD operations.", "external_files": ["localStorage", "import.meta.env"], "external_methods": ["localStorage.getItem", "localStorage.setItem", "Date.now", "Date.prototype.toLocaleString", "JSON.parse", "JSON.stringify", "globalThis.crypto.randomUUID"], "published": ["Note", "NotesState", "NotesListener", "StorageAdapter", "notesStore", "humanDate"], "classes": [{"name": "LocalStorageAdapter", "description": "Implements StorageAdapter interface using the browser's localStorage for persistence.", "methods": [{"name": "load", "description": "Loads notes from localStorage, parsing JSON and returning an array of Note objects."}, {"name": "save", "description": "Saves the provided notes array to localStorage as a JSON string."}]}, {"name": "NotesStore", "description": "Manages the notes state, subscriptions, and persistence logic, providing methods for CRUD operations.", "methods": [{"name": "subscribe", "description": "Adds a listener callback for state changes; returns an unsubscribe function."}, {"name": "getState", "description": "Returns a copy of the current notes state."}, {"name": "init", "description": "Initializes the store by loading notes from storage and setting the initial selection."}, {"name": "select", "description": "Sets the currently selected note by its ID, or clears selection."}, {"name": "create", "description": "Creates a new note with default title/content, adds it to state, and selects it."}, {"name": "update", "description": "Updates a note's title or content and refreshes its timestamp."}, {"name": "remove", "description": "Deletes a note by its ID and updates the selection if needed."}, {"name": "persist", "description": "Private method to save current notes state via the adapter."}]}], "methods": [{"name": "export function humanDate(ms: number): string { humanDate", "description": "Formats a timestamp (ms since epoch) into a human-readable date string.", "scope": "", "scopeKind": ""}, {"name": "function isBrowser(): boolean { isBrowser", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async load(): Promise<Note[]> { load", "scope": "LocalStorageAdapter", "scopeKind": "class", "description": "unavailable"}, {"name": "load(): Promise<Note[]>; load", "scope": "StorageAdapter", "scopeKind": "interface", "description": "unavailable"}, {"name": "function pickAdapter(): StorageAdapter { pickAdapter", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async save(notes: Note[]): Promise<void> { save", "scope": "LocalStorageAdapter", "scopeKind": "class", "description": "unavailable"}, {"name": "save(notes: Note[]): Promise<void>; save", "scope": "StorageAdapter", "scopeKind": "interface", "description": "unavailable"}], "calls": ["isBrowser", "localStorage.getItem", "localStorage.setItem", "JSON.parse", "JSON.stringify", "Date.now", "localStorage.getItem", "localStorage.setItem", "(import.meta as any).env?.PUBLIC_API_BASE", "(import.meta as any).env?.PUBLIC_BACKEND_URL", "crypto.randomUUID"], "search-terms": ["NotesState", "StorageAdapter", "LocalStorageAdapter", "notesStore", "persistent notes", "note CRUD", "notes subscription", "notes timestamp", "notes creation", "localStorage"], "state": 2, "file_id": 8, "knowledge_revision": 19, "git_revision": "", "revision_history": [{"17": ""}, {"19": ""}], "ctags": [{"_type": "tag", "name": "LocalStorageAdapter", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^class LocalStorageAdapter implements StorageAdapter {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "Note", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export type Note = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "NotesListener", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export type NotesListener = (state: NotesState) => void;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "NotesState", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export type NotesState = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "NotesStore", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^class NotesStore {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "STORAGE_KEY", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^const STORAGE_KEY = 'notes.v1';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "StorageAdapter", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export interface StorageAdapter {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "apiBase", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const apiBase: any = (import.meta as any).env?.PUBLIC_API_BASE || (import.meta as any).env?.PU/", "language": "TypeScript", "kind": "constant", "scope": "pickAdapter", "scopeKind": "function"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      content,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "d", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  const d = new Date(ms);$/", "language": "TypeScript", "kind": "constant", "scope": "humanDate", "scopeKind": "function"}, {"_type": "tag", "name": "humanDate", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export function humanDate(ms: number): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const id = maybeCrypto?.randomUUID ? maybeCrypto.randomUUID() : String(now) + Math.random()./", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const idx = this.state.notes.findIndex((n) => n.id === id);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const updated: Note = { ...this.state.notes[idx], ...patch, updatedAt: now };$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "isBrowser", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^function isBrowser(): boolean {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "l", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    for (const l of Array.from(this.listeners)) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "listeners", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  private listeners: Set<NotesListener> = new Set();$/", "language": "TypeScript", "kind": "property", "scope": "NotesStore", "scopeKind": "class"}, {"_type": "tag", "name": "load", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  async load(): Promise<Note[]> {$/", "language": "TypeScript", "kind": "method", "scope": "LocalStorageAdapter", "scopeKind": "class"}, {"_type": "tag", "name": "load", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  load(): Promise<Note[]>;$/", "language": "TypeScript", "kind": "method", "scope": "StorageAdapter", "scopeKind": "interface"}, {"_type": "tag", "name": "maybeCrypto", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const id = maybeCrypto?.randomUUID ? maybeCrypto.randomUUID() : String(now) + Math.random()./", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "maybeCrypto", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const maybeCrypto: any = (globalThis as any).crypto;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "note", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const note: Note = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "notes", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const notes = await this.adapter.load();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "notesStore", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^export const notesStore = new NotesStore(pickAdapter());$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const now = Date.now();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "parsed", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      const parsed = JSON.parse(raw);$/", "language": "TypeScript", "kind": "constant", "scope": "LocalStorageAdapter.load", "scopeKind": "method"}, {"_type": "tag", "name": "pickAdapter", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^function pickAdapter(): StorageAdapter {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      const raw = localStorage.getItem(STORAGE_KEY);$/", "language": "TypeScript", "kind": "constant", "scope": "LocalStorageAdapter.load", "scopeKind": "method"}, {"_type": "tag", "name": "save", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  async save(notes: Note[]): Promise<void> {$/", "language": "TypeScript", "kind": "method", "scope": "LocalStorageAdapter", "scopeKind": "class"}, {"_type": "tag", "name": "save", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  save(notes: Note[]): Promise<void>;$/", "language": "TypeScript", "kind": "method", "scope": "StorageAdapter", "scopeKind": "interface"}, {"_type": "tag", "name": "state", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^  private state: NotesState = { notes: [], selectedId: null };$/", "language": "TypeScript", "kind": "property", "scope": "NotesStore", "scopeKind": "class"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      title,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const updated: Note = { ...this.state.notes[idx], ...patch, updatedAt: now };$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "updatedAt", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^      updatedAt: now,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "updatedAt", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const updated: Note = { ...this.state.notes[idx], ...patch, updatedAt: now };$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "wasSelected", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-292588-292597/frontend/src/lib/notesStore.ts", "pattern": "/^    const wasSelected = this.state.selectedId === id;$/", "language": "TypeScript", "kind": "constant"}], "hash": "e429de8d68655d332c82bd5e2f49c0d0", "format-version": 4, "code-base-name": "frontend", "filename": "frontend/src/lib/notesStore.ts", "fields": [{"name": "export interface StorageAdapter {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private listeners: Set<NotesListener> = new Set();", "scope": "NotesStore", "scopeKind": "class", "description": "unavailable"}, {"name": "private state: NotesState = { notes: [], selectedId: null };", "scope": "NotesStore", "scopeKind": "class", "description": "unavailable"}]}